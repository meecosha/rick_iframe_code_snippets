<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code</title>
  <style>
    :root{
      --page-bg: transparent;
      --code-bg:#ffffff;
      --code-text:#181A24;
      --btn-bg:rgba(24,26,36,0.9);
      --btn-hover:rgba(24,26,36,1);
      --btn-text:#ffffff;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }

    html,body{
      margin:0;padding:0;
      background:var(--page-bg);
      color:var(--code-text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .wrap{padding:0;margin:0;}

    .code-surface{
      position:relative;
      background:var(--code-bg);
      color:var(--code-text);
      border-radius:8px;
      overflow:visible;
    }
    pre{
      margin:0;
      padding:16px 18px;
      font-family:var(--mono);
      font-size:13px;
      line-height:1.5;
      white-space:pre;
      tab-size:2;
      -moz-tab-size:2;
    }

    /* Floating copy button */
    #copy-btn{
      position: absolute;
      top: 20px;  /* Moves the button down a little */
      right: 8px;
      appearance: none;
      border: none;
      background: var(--btn-bg);
      color: var(--btn-text);
      font-size: 12px;
      font-weight: 600;
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
      transition: background 0.15s ease;
    }  
    #copy-btn:hover{background:var(--btn-hover);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="code-surface">
      <button id="copy-btn" type="button" title="Copy code to clipboard">Copy</button>
      <pre id="code-pre"><code id="code-block"></code></pre>
    </div>
  </div>

  <textarea id="snippet" style="display:none;">
POST /transactions/examplecompany/create
Host: exchange.rick.ai
Content-Type: application/json

{
  "transaction_id": "23d",
  "user_id": "8070",
  "ga_client_id": "1599344136.1453219348",
  "ym_client_id": "1693556325685376429",
  "deal_created_at": 1457452914,
  "status": "paid",
  "data_source": "website1.ru",
  "revenue": 300,
  "grossprofit": 30,
  "items": [
    {
      "name": "Home cleaning",
      "sku": "32354",
      "price": "200",
      "quantity": 1,
      "category": "Cleaning"
    },
    {
      "name": "Kitchen cleaning",
      "sku": "32354",
      "price": "100",
      "quantity": 1,
      "category": "Cleaning"
    }
  ],
  "contact": {
    "phone_number": "+79871234567",
    "phone_number_hash": "094c9957c54235232dde8a1064fd261be2af0fa7",
    "email": "example@gmail.com",
    "email_hash": "5d59f22ef88d9b6351d529e5c2c23156fdf3ba45"
  }
}
  </textarea>

  <script>
    const qs = (s, el=document) => el.querySelector(s);
    const codeBlock = qs("#code-block");
    const copyBtn   = qs("#copy-btn");

    // Load code
    // NEW: try ?src=<filename> under /snippets, else fallback to <textarea>
    const params = new URLSearchParams(location.search);
    const src = params.get("src"); // e.g. src=post-request.txt
    
    async function loadCode() {
      if (src) {
        const url = `./snippets/${src}`;
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`Failed to load ${url}`);
        return await res.text();
      }
      // fallback to inline textarea
      return qs("#snippet").value.replace(/^\n/, "");
    }
    
    loadCode().then(text => {
      codeBlock.textContent = text;
    }).catch(err => {
      codeBlock.textContent = `/* failed to load snippet: ${err.message} */`;
    });

    // Copy handler
    copyBtn.addEventListener("click", async () => {
      const text = codeBlock.textContent;
      let copied = false;

      try {
        await navigator.clipboard.writeText(text);
        copied = true;
      } catch (_) {
        try {
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.setAttribute("readonly", "");
          ta.style.position = "fixed";
          ta.style.opacity = "0";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          copied = true;
        } catch (e) {}
      }

      if (copied) {
        const oldText = copyBtn.textContent;
        copyBtn.textContent = "Copied!";
        setTimeout(() => { copyBtn.textContent = oldText; }, 1500);
      }
    });

    // Auto-resize for iframe embed
    const postHeight = () => {
      const h = document.body.scrollHeight;
      parent.postMessage({ type: "snippet:height", height: h }, "*");
    };
    window.addEventListener("load", postHeight);
    new ResizeObserver(postHeight).observe(document.body);
  </script>
  <script>
  // Enable with ?fit=1 in the URL if you want this behavior
  (function fitToViewport() {
    const params = new URLSearchParams(location.search);
    if (params.get("fit") !== "1") return;

    const root = document.body;          // scale the whole page
    const container = document.documentElement;

    function applyFit() {
      // Total natural content height
      const contentHeight = root.scrollHeight;
      const contentWidth  = root.scrollWidth;

      // Viewport (iframe) size granted by parent
      const vh = window.innerHeight || 0;
      const vw = window.innerWidth  || 0;

      // Compute scale to fit without cropping; never upscale
      const scaleH = vh > 0 ? vh / contentHeight : 1;
      const scaleW = vw > 0 ? vw / contentWidth  : 1;
      const scale  = Math.min(1, scaleH, scaleW);

      // Prevent internal scrollbars
      container.style.overflow = "hidden";
      root.style.overflow = "hidden";

      // Scale from top-left and stretch layout width so lines donâ€™t wrap weirdly
      root.style.transform = `scale(${scale})`;
      root.style.transformOrigin = "top left";
      root.style.width = (100 / scale) + "%";
      root.style.height = (100 / scale) + "%";
    }

    // Re-fit on viewport changes and content changes
    window.addEventListener("resize", applyFit);
    new ResizeObserver(applyFit).observe(document.body);
    applyFit();
  })();
</script>
</body>
</html>
